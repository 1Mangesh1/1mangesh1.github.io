---
// Clean visitor counter using JSON API for better styling control
---
<div id="clean-visitor-counter" class="text-sm text-gray-600 dark:text-gray-400">
  <span id="clean-views">--</span> views
</div>

<script>
  // Clean visitor counter using JSON API with fallback
  function initCleanCounter() {
    // Wait for GoatCounter to load
    if (typeof (window as any).goatcounter === 'undefined') {
      setTimeout(initCleanCounter, 100);
      return;
    }

    try {
      // Get current path - ensure it starts with /
      const currentPath = window.location.pathname || '/';
      
      // Try JSON API first
      fetch(`https://mangeshbide.goatcounter.com/counter${currentPath}.json`)
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        })
        .then(data => {
          const viewsElement = document.getElementById('clean-views');
          if (viewsElement) {
            viewsElement.textContent = data.count;
            viewsElement.className = 'text-blue-600 dark:text-blue-400 font-semibold';
          }
        })
        .catch(error => {
          console.log('JSON API failed, trying JavaScript API:', error);
          // Fallback to JavaScript API
          try {
            (window as any).goatcounter.visit_count!({
              append: "#clean-views",
              no_branding: true,
              type: "html",
              style: `
                div {
                  border: none !important;
                  background-color: transparent !important;
                  color: #3b82f6 !important;
                  font-size: inherit !important;
                  padding: 0 !important;
                  border-radius: 0 !important;
                  font-family: inherit !important;
                  font-weight: inherit !important;
                  line-height: inherit !important;
                  display: inline !important;
                  margin: 0 !important;
                  box-shadow: none !important;
                }
                .dark div {
                  color: #60a5fa !important;
                }
                #gcvc-for {
                  display: none !important;
                }
                #gcvc-by {
                  display: none !important;
                }
                #gcvc-views {
                  color: #3b82f6 !important;
                  font-weight: 600 !important;
                }
                .dark #gcvc-views {
                  color: #60a5fa !important;
                }
              `
            });
          } catch (jsError) {
            console.log('JavaScript API also failed:', jsError);
            const viewsElement = document.getElementById('clean-views');
            if (viewsElement) {
              viewsElement.textContent = '--';
            }
          }
        });
    } catch (error) {
      console.log('Clean counter error:', error);
    }
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCleanCounter);
  } else {
    initCleanCounter();
  }
</script>

<style>
  #clean-visitor-counter {
    display: inline-block;
    margin-left: 0.5rem;
  }
</style> 