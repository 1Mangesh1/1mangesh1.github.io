---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Filter drafts in production, show all in development
const allSnippets = await getCollection('snippets', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});
const sortedSnippets = allSnippets.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const languageColors: Record<string, string> = {
  javascript: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
  typescript: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
  python: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
  css: 'bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200',
  html: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
  bash: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200',
  sql: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
  go: 'bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200',
  rust: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
  other: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200',
};
---

<Layout title="Code Snippets | Mangesh Bide" description="Reusable code patterns and snippets in JavaScript, TypeScript, Python, CSS, and more for quick reference.">
  <div class="max-w-4xl mx-auto px-4 py-12">
    <div class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Code Snippets</h1>
      <p class="text-gray-600 dark:text-gray-400">Reusable code patterns I reference often</p>
    </div>

    <div class="grid gap-6">
      {sortedSnippets.map((snippet) => (
        <a
          href={`/snippets/${snippet.slug}`}
          class="block border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-600 transition-all"
        >
          <div class="flex items-center justify-between mb-3">
            <span class={`px-3 py-1 text-sm font-medium rounded ${languageColors[snippet.data.language]}`}>
              {snippet.data.language}
            </span>
          </div>

          <h2 class="text-xl font-semibold mb-2">{snippet.data.title}</h2>
          <p class="text-gray-600 dark:text-gray-400 mb-3">{snippet.data.description}</p>

          {snippet.data.tags && (
            <div class="flex flex-wrap gap-2">
              {snippet.data.tags.map((tag) => (
                <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-xs rounded">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </a>
      ))}
    </div>
  </div>
</Layout>
