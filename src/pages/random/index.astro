---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Filter drafts in production, show all in development
const allRandom = await getCollection('random', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});
const sortedRandom = allRandom.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  }).format(date);
};

const typeIcons: Record<string, string> = {
  thought: 'ğŸ’­',
  idea: 'ğŸ’¡',
  experiment: 'ğŸ§ª',
  note: 'ğŸ“',
  rant: 'ğŸ”¥',
  'shower-thought': 'ğŸš¿',
};

const typeColors: Record<string, string> = {
  thought: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
  idea: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
  experiment: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
  note: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200',
  rant: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
  'shower-thought': 'bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200',
};
---

<Layout title="Random Thoughts | Mangesh Bide" description="Miscellaneous thoughts, ideas, and experiments. Random musings on technology, development, and life.">
  <div class="max-w-4xl mx-auto px-4 py-12">
    <div class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Random</h1>
      <p class="text-gray-600 dark:text-gray-400">Thoughts, ideas, experiments, and other miscellaneous musings</p>
    </div>

    <div class="space-y-6">
      {sortedRandom.map(async (item) => {
        const { Content } = await item.render();
        return (
          <article class="border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center gap-3 mb-3">
              {item.data.type && (
                <>
                  <span class="text-xl">{typeIcons[item.data.type] || 'ğŸ“Œ'}</span>
                  <span class={`px-2 py-1 text-xs rounded ${typeColors[item.data.type] || typeColors.note}`}>
                    {item.data.type}
                  </span>
                </>
              )}
              <time class="text-sm text-gray-500 dark:text-gray-400 ml-auto" datetime={item.data.date.toISOString()}>
                {formatDate(item.data.date)}
              </time>
            </div>

            <h2 class="text-xl font-semibold mb-2">{item.data.title}</h2>

            {item.data.description && (
              <p class="text-gray-600 dark:text-gray-400 mb-3 italic">{item.data.description}</p>
            )}

            {item.data.mood && (
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Mood: {item.data.mood}</p>
            )}

            <div class="prose dark:prose-invert prose-sm max-w-none">
              <Content />
            </div>

            {item.data.tags && (
              <div class="flex flex-wrap gap-2 mt-4">
                {item.data.tags.map((tag) => (
                  <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-xs rounded">
                    #{tag}
                  </span>
                ))}
              </div>
            )}
          </article>
        );
      })}
    </div>
  </div>
</Layout>
